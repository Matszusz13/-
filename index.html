<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>üíñ Dla Ciebie</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Cormorant+Garamond:wght@400;600&family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
:root{
  --bg1:#120014;
  --bg2:#2a0030;
  --text:#ffe9ff;
  --muted:#ffd0ffcc;
  --accent:#ff4da6;
  --accent2:#ff7aa8;

  --paper:#fff7fb;
  --paperText:#240018;

  --glass: rgba(0,0,0,.38);
  --glassBorder: rgba(255,255,255,.18);

  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  overflow:hidden;
  font-family:Poppins,system-ui,sans-serif;
  background:linear-gradient(160deg,var(--bg1),var(--bg2));
  color:var(--text);
}

/* ===== T≈ÅO MP4 ===== */
#bgVideo{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:0;
  opacity:0;
  transition:opacity 1.4s ease;
  filter:saturate(1.05) contrast(1.03);
}

/* ===== ETAPY ===== */
.stage{
  position:fixed;
  inset:0;
  display:grid;
  place-items:center;
  z-index:10;
  pointer-events:auto;
}
.hidden{display:none !important}

/* ETAP 1 */
.stage1{
  background:
    radial-gradient(900px 600px at 50% 40%, #ff4da61f, transparent 70%),
    linear-gradient(160deg, #0b000e, #230027);
}
.bigStartBtn{
  width:clamp(210px,60vw,360px);
  height:clamp(210px,60vw,360px);
  border-radius:50%;
  border:none;
  font-size:clamp(22px,5vw,34px);
  font-weight:900;
  cursor:pointer;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#120016;
  animation:pulse 1.2s infinite;
  box-shadow:0 18px 65px #ff2f8a55;
  -webkit-tap-highlight-color: transparent;
}
.bigStartBtn:active{ transform:scale(.98); }
@keyframes pulse{
  0%{box-shadow:0 18px 65px #ff2f8a55, 0 0 0 0 #ff4da6aa}
  70%{box-shadow:0 18px 65px #ff2f8a55, 0 0 0 35px transparent}
  100%{box-shadow:0 18px 65px #ff2f8a55, 0 0 0 0 transparent}
}

/* ETAP 2 */
.stage2{ background:transparent; }
.askBox{
  width:clamp(320px,86vw,680px);
  padding:clamp(22px,6vw,60px);
  border-radius:28px;
  background:#ffffff14;
  border:1px solid #ffffff22;
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  text-align:center;
  box-shadow:0 22px 70px #00000066;
}
.askTitle{
  font-family:"Great Vibes",cursive;
  font-size:clamp(36px,8vw,74px);
  line-height:1;
}
.askSubtitle{
  margin-top:12px;
  font-size:clamp(14px,3.2vw,18px);
  color:#ffd0ffdd;
}
.btnRow{
  margin-top:clamp(18px,4vw,34px);
  display:flex;
  justify-content:center;
  gap:clamp(12px,3vw,30px);
  flex-wrap:wrap;
}
.btn{
  padding:clamp(14px,3vw,18px) clamp(22px,5vw,38px);
  border-radius:999px;
  border:none;
  font-size:clamp(16px,3.5vw,26px);
  font-weight:900;
  cursor:pointer;
  box-shadow:0 16px 40px #00000035;
  -webkit-tap-highlight-color: transparent;
}
.btn:active{ transform:scale(.98); }
.yesBtn{ background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#120016; }
.noBtn{ background:#ffffff20; color:var(--text); border:1px solid #ffffff30; }

/* ===== ETAP 3 UI ===== */
.ui{ position:fixed; inset:0; z-index:20; pointer-events:none; }

.note{
  position:absolute;
  top:14px;
  left:50%;
  transform:translateX(-50%);
  width:min(980px,94vw);
  pointer-events:none;

  background:rgba(0,0,0,.28);
  border:1px solid rgba(255,255,255,.12);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  border-radius:18px;
  padding:12px 14px;
  color:#ffd0ffef;
  font-size:clamp(12px,2.7vw,14px);
  text-align:center;
  box-shadow:0 22px 70px rgba(0,0,0,.45);
}

/* ===== LISTY: panel kart (sortowane po dacie) ===== */
.lettersPanel{
  position:absolute;
  left:50%;
  top:78px;
  transform:translateX(-50%);
  width:min(980px,94vw);
  pointer-events:auto;

  background:var(--glass);
  border:1px solid var(--glassBorder);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  border-radius:22px;
  box-shadow:0 22px 70px rgba(0,0,0,.65);
  padding:clamp(12px,2.6vw,18px);

  max-height:33vh;
  overflow:auto;
}
.lettersTitle{
  font-weight:900;
  margin:0 0 10px;
  color:#ffd0ffef;
  display:flex;
  align-items:center;
  gap:8px;
  font-size:clamp(14px,2.8vw,18px);
}
.lettersGrid{
  display:grid;
  /* kolejno≈õƒá: lewo‚Üíprawo, potem g√≥ra‚Üíd√≥≈Ç */
  grid-auto-flow: row;
  grid-template-columns:repeat(3, minmax(0,1fr));
  gap:10px;
}
@media (max-width:820px){ .lettersGrid{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
@media (max-width:520px){ .lettersGrid{ grid-template-columns:repeat(1, minmax(0,1fr)); } }

.letterCard{
  background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
  border:1px solid rgba(255,255,255,.18);
  border-radius:16px;
  padding:12px 12px;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  position:relative;
  overflow:hidden;
}
.letterCard:active{ transform:scale(.99); }
.cardTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.cardDate{
  font-size:12px;
  color:rgba(255,255,255,.82);
  font-weight:800;
  white-space:nowrap;
}
.cardBadge{
  font-size:12px;
  color:#120016;
  font-weight:900;
  padding:6px 10px;
  border-radius:999px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
}
.cardTitle{
  margin:10px 0 0;
  font-weight:900;
  font-size:clamp(13px,2.9vw,16px);
  color:#ffe9ffef;
}
.cardHint{
  margin:6px 0 0;
  font-size:12px;
  color:#ffd0ffcc;
}

/* Specjalna karta: "KsiƒÖ≈ºka" (zdjƒôcia) */
.bookCard{
  background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.10));
  border:1px solid rgba(255,255,255,.22);
}
.bookCard .cardBadge{
  background:rgba(255,255,255,.16);
  color:#fff;
  border:1px solid rgba(255,255,255,.18);
}
.bookIcon{
  font-size:34px;
  line-height:1;
  margin-top:6px;
}
.bookCard.open{
  outline:2px solid rgba(255,255,255,.55);
}

/* ===== Koperta + list (animacja) ===== */
.envelopeArea{
  position:absolute;
  left:50%;
  top:54%;
  transform:translate(-50%,-50%);
  width:min(740px,94vw);
  display:grid;
  place-items:center;
  pointer-events:auto;
}

.hint{
  margin-top:14px;
  font-size:clamp(12px,2.6vw,15px);
  color:#ffd0ffdd;
  text-align:center;
  opacity:.95;
  text-shadow:0 10px 30px rgba(0,0,0,.55);
}

.envelopeWrap{
  position:relative;
  width:clamp(280px,70vw,520px);
  height:clamp(190px,48vw,340px);
  filter: drop-shadow(0 22px 70px rgba(0,0,0,.65));
}

/* Papier (list) */
.letter{
  position:absolute;
  left:50%;
  bottom:18%;
  transform:translateX(-50%);
  width:92%;
  max-width:520px;
  height:80%;
  background:linear-gradient(180deg, #fff, var(--paper));
  border-radius:16px;
  border:1px solid rgba(0,0,0,.08);
  padding:clamp(14px,3.5vw,22px);
  color:var(--paperText);
  overflow:auto;
  box-shadow:0 12px 35px rgba(0,0,0,.18);
  z-index:1;

  translate: 0 40%;
  opacity:0;
  transition: translate .65s cubic-bezier(.2,.9,.2,1), opacity .35s ease;
}
.envelopeWrap.open .letter{
  translate: 0 -22%;
  opacity:1;
}

.letterHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.letterDate{
  font-size:12px;
  color:rgba(0,0,0,.55);
  font-weight:800;
  white-space:nowrap;
}

.letterTitle{
  font-family:"Great Vibes",cursive;
  font-size:clamp(34px,7vw,56px);
  margin:6px 0 10px;
  line-height:1.05;
}

.letterBody{
  font-family:"Cormorant Garamond",serif;
  font-size:clamp(16px,3.6vw,22px);
  line-height:1.55;
}
.letterBody p{ margin:10px 0; }

.signature{
  margin-top:14px;
  font-family:"Great Vibes",cursive;
  font-size:clamp(22px,5vw,36px);
  text-align:right;
  opacity:.95;
}

/* Koperta */
.envelope{
  position:absolute;
  inset:0;
  border-radius:18px;
  background:linear-gradient(145deg, rgba(255,255,255,.92), rgba(255,255,255,.84));
  border:1px solid rgba(255,255,255,.40);
  overflow:hidden;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  z-index:2;
}
.envelope:active{ transform:scale(.99); }

.envBottom:before,
.envBottom:after{
  content:"";
  position:absolute;
  bottom:0;
  width:60%;
  height:64%;
  background:linear-gradient(135deg, var(--accent), var(--accent2));
  opacity:.95;
}
.envBottom:before{ left:-10%; clip-path:polygon(0 100%, 100% 100%, 100% 0); }
.envBottom:after{ right:-10%; clip-path:polygon(0 0, 0 100%, 100% 100%); }

.envMid{
  position:absolute;
  inset:0;
  background:linear-gradient(135deg, rgba(255,77,166,.92), rgba(255,122,168,.92));
  clip-path:polygon(0 100%, 50% 55%, 100% 100%, 50% 100%);
  opacity:.55;
}

.envFlap{
  position:absolute;
  top:-1px;
  left:-1px;
  right:-1px;
  height:65%;
  background:linear-gradient(135deg, var(--accent), var(--accent2));
  clip-path:polygon(0 0, 100% 0, 50% 62%);
  transform-origin:top center;
  transform:rotateX(0deg);
  transition: transform .65s cubic-bezier(.2,.9,.2,1);
  box-shadow:0 12px 30px rgba(0,0,0,.18);
  z-index:3;
}
.envelopeWrap.open .envFlap{ transform:rotateX(165deg); }

.seal{
  position:absolute;
  left:50%;
  top:58%;
  transform:translate(-50%,-50%);
  width:clamp(46px,10vw,66px);
  height:clamp(46px,10vw,66px);
  border-radius:50%;
  background:rgba(255,255,255,.25);
  border:1px solid rgba(255,255,255,.35);
  backdrop-filter: blur(8px);
  display:grid;
  place-items:center;
  z-index:4;
}
.seal span{ font-size:clamp(18px,4.2vw,28px); }

.envelopeArea.hiddenSoft{
  opacity:0;
  transform:translate(-50%,-50%) scale(.98);
  pointer-events:none;
}
.envelopeArea.showSoft{
  opacity:1;
  transform:translate(-50%,-50%) scale(1);
  pointer-events:auto;
  transition:opacity .7s ease, transform .7s ease;
}

/* ===== Folder na zdjƒôcia (ZWYKLE ZAMKNIƒòTY) ===== */
.folder{
  position:absolute;
  left:50%;
  bottom:calc(14px + var(--safe-bottom));
  transform:translateX(-50%);
  width:min(980px,94vw);
  pointer-events:auto;

  background:var(--glass);
  border:1px solid var(--glassBorder);
  backdrop-filter:blur(10px);
  -webkit-backdrop-filter:blur(10px);
  border-radius:22px;
  box-shadow:0 22px 70px rgba(0,0,0,.65);
  padding:clamp(12px,2.6vw,18px);

  /* animacja otw√≥rz/zamknij */
  transition: transform .45s ease, opacity .35s ease;
  transform:translateX(-50%) translateY(110%);
  opacity:0;
}
.folder.open{
  transform:translateX(-50%) translateY(0%);
  opacity:1;
}

.folderTitle{
  font-weight:900;
  margin:0 0 10px;
  color:#ffd0ffef;
  display:flex;
  align-items:center;
  gap:8px;
  font-size:clamp(14px,2.8vw,18px);
}

.photoGrid{
  display:grid;
  grid-template-columns:repeat(5,minmax(0,1fr));
  gap:10px;
}
@media (max-width:700px){ .photoGrid{ grid-template-columns:repeat(3,minmax(0,1fr)); } }
@media (max-width:420px){ .photoGrid{ grid-template-columns:repeat(2,minmax(0,1fr)); } }

.thumb{
  position:relative;
  border-radius:14px;
  overflow:hidden;
  background:rgba(255,255,255,.10);
  border:1px dashed rgba(255,255,255,.38);
  aspect-ratio: 1 / 1;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}
.thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  opacity:0;
  transform:scale(1);
  transition:opacity .35s ease, transform .25s ease;
}
.thumb.loaded img{ opacity:1; }
.thumb:hover img{ transform:scale(1.03); }

.thumbLabel{
  position:absolute;
  inset:auto 8px 8px 8px;
  font-size:11px;
  color:rgba(255,255,255,.9);
  text-shadow:0 8px 20px rgba(0,0,0,.65);
  background:rgba(0,0,0,.25);
  border:1px solid rgba(255,255,255,.18);
  backdrop-filter: blur(8px);
  padding:6px 8px;
  border-radius:999px;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

/* ===== Lightbox ===== */
#lightbox{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.82);
  display:none;
  place-items:center;
  z-index:999;
  cursor:pointer;
  padding:18px;
}
#lightbox.show{ display:grid; }

#lightboxStage{
  position:relative;
  width:min(1200px, 96vw);
  height:92vh;
  display:grid;
  place-items:center;
}
#lightboxImg{
  max-width:100%;
  max-height:100%;
  border-radius:18px;
  box-shadow:0 30px 90px rgba(0,0,0,.75);
  will-change: transform, opacity;
}

.lbBtn{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:56px;
  height:56px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(0,0,0,.35);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  color:#fff;
  font-size:22px;
  display:grid;
  place-items:center;
  cursor:pointer;
  user-select:none;
}
.lbBtn:active{ transform:translateY(-50%) scale(.98); }
#lbPrev{ left:-8px; }
#lbNext{ right:-8px; }

.lbTopBar{
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  align-items:center;
  gap:10px;
  background:rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.18);
  border-radius:999px;
  padding:10px 12px;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.lbSmallBtn{
  border:none;
  cursor:pointer;
  padding:8px 12px;
  border-radius:999px;
  font-weight:900;
  background:rgba(255,255,255,.14);
  color:#fff;
}
.lbSmallBtn.active{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#120016;
}
#lbCounter{ font-weight:900; color:#ffd0ffef; font-size:13px; padding:0 6px; }
  </style>
</head>

<body>

  <video id="bgVideo" muted loop playsinline preload="auto">
    <source src="background.mp4" type="video/mp4">
  </video>

  <!-- ETAP 1 -->
  <div id="stage1" class="stage stage1">
    <button id="startBigBtn" class="bigStartBtn">Kliknij</button>
  </div>

  <!-- ETAP 2 -->
  <div id="stage2" class="stage stage2 hidden">
    <div class="askBox">
      <div class="askTitle">Mam pytanie‚Ä¶ üíû</div>
      <div class="askSubtitle">Czy zostaniesz mojƒÖ walentynkƒÖ ?</div>
      <div class="btnRow">
        <button id="yesBtn" class="btn yesBtn">Tak</button>
        <button id="noBtn" class="btn noBtn">Nie</button>
      </div>
    </div>
  </div>

  <!-- ETAP 3 UI -->
  <div class="ui">
    <div class="note hidden" id="noteTop">
      üí° Panel list√≥w jest u g√≥ry. Ikona ksiƒÖ≈ºki üìñ otwiera / zamyka folder ze zdjƒôciami. Koperta pojawia siƒô po 5 sekundach. W fullscreen: ‚Üê ‚Üí, ESC, pokaz slajd√≥w ‚ñ∂Ô∏é.
    </div>

    <!-- PANEL LIST√ìW -->
    <div class="lettersPanel hidden" id="lettersPanel" aria-hidden="true">
      <div class="lettersTitle">üìú Listy</div>
      <div class="lettersGrid" id="lettersGrid"></div>
    </div>

    <!-- KOPERTA -->
    <div id="envelopeArea" class="envelopeArea hiddenSoft" aria-hidden="true">
      <div class="envelopeWrap" id="envelopeWrap">
        <div class="letter" id="letter" aria-hidden="true">
          <div class="letterHeader">
            <div class="letterDate" id="letterDate">‚Äî</div>
          </div>
          <div class="letterTitle" id="letterTitle">‚Äî</div>
          <div class="letterBody" id="letterBody"></div>
          <div class="signature" id="letterSign">‚Äî</div>
        </div>

        <div class="envelope" id="envelope" aria-label="Koperta (kliknij)">
          <div class="envBottom"></div>
          <div class="envMid"></div>
          <div class="envFlap"></div>
          <div class="seal"><span>üíó</span></div>
        </div>
      </div>
      <div class="hint">Kliknij kopertƒô üíå</div>
    </div>

    <!-- FOLDER ZDJƒòƒÜ (zamkniƒôty pod ksiƒÖ≈ºkƒÖ) -->
    <div class="folder" id="folder" aria-hidden="true">
      <div class="folderTitle">üìÇ Nasze zdjƒôcia</div>
      <div class="photoGrid" id="photoGrid"></div>
    </div>
  </div>

  <!-- LIGHTBOX -->
  <div id="lightbox" aria-hidden="true" title="Kliknij, aby zamknƒÖƒá">
    <div id="lightboxStage">
      <div class="lbTopBar" id="lbTopBar">
        <button class="lbSmallBtn" id="lbPlay" type="button" title="Start/Stop pokazu">‚ñ∂Ô∏é</button>
        <div id="lbCounter">‚Äî</div>
        <button class="lbSmallBtn" id="lbClose" type="button" title="Zamknij (ESC)">‚úï</button>
      </div>
      <button class="lbBtn" id="lbPrev" type="button" title="Poprzednie (‚Üê)">‚Äπ</button>
      <img id="lightboxImg" alt="Powiƒôkszone zdjƒôcie">
      <button class="lbBtn" id="lbNext" type="button" title="Nastƒôpne (‚Üí)">‚Ä∫</button>
    </div>
  </div>

  <audio id="music" preload="auto" loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const stage1 = document.getElementById("stage1");
  const stage2 = document.getElementById("stage2");
  const startBtn = document.getElementById("startBigBtn");
  const yesBtn = document.getElementById("yesBtn");
  const noBtn  = document.getElementById("noBtn");

  const bgVideo = document.getElementById("bgVideo");
  const music = document.getElementById("music");

  const envelopeArea = document.getElementById("envelopeArea");
  const envelopeWrap = document.getElementById("envelopeWrap");
  const envelope = document.getElementById("envelope");
  const letter = document.getElementById("letter");

  const lettersPanel = document.getElementById("lettersPanel");
  const lettersGrid = document.getElementById("lettersGrid");

  const folder = document.getElementById("folder");
  const photoGrid = document.getElementById("photoGrid");

  const noteTop = document.getElementById("noteTop");

  const letterDate = document.getElementById("letterDate");
  const letterTitle = document.getElementById("letterTitle");
  const letterBody  = document.getElementById("letterBody");
  const letterSign  = document.getElementById("letterSign");

  // Lightbox elements
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightboxImg");
  const lbPrev = document.getElementById("lbPrev");
  const lbNext = document.getElementById("lbNext");
  const lbClose = document.getElementById("lbClose");
  const lbPlay = document.getElementById("lbPlay");
  const lbCounter = document.getElementById("lbCounter");

  // Kliknij / Dotknij
  function isTouch(){
    return matchMedia("(pointer:coarse)").matches && !matchMedia("(pointer:fine)").matches;
  }
  function updateStartText(){
    startBtn.textContent = isTouch() ? "Dotknij" : "Kliknij";
  }
  updateStartText();
  addEventListener("resize", updateStartText);

  // Muzyka (g≈Ço≈õno≈õƒá)
  const MUSIC_VOL = 0.25;
  const clamp01 = (v)=> Math.max(0, Math.min(1, v));
  function fadeTo(el, target, ms=900){
    const to = clamp01(target);
    const from = clamp01(el.volume ?? 0);
    const t0 = performance.now();
    const tick = (t)=>{
      const k = Math.min(1, (t - t0)/ms);
      el.volume = clamp01(from + (to - from)*k);
      if(k < 1) requestAnimationFrame(tick);
    };
    requestAnimationFrame(tick);
  }

  // Etap 1 -> 2
  startBtn.addEventListener("click", () => {
    stage1.classList.add("hidden");
    stage2.classList.remove("hidden");
  });

  // Etap 2: zmiana tekst√≥w na "Nie"
  let noCount = 0;
  const noPhrases = ["Nie","Na pewno nie üòè","Spr√≥buj jeszcze raz","Prawie üò≥","No dobrze‚Ä¶"];
  noBtn.addEventListener("click", () => {
    if(noCount >= noPhrases.length - 1){
      noBtn.textContent = "Tak <3";
      noBtn.style.background = "linear-gradient(135deg,#ff4da6,#ff7aa8)";
      noBtn.style.color = "#120016";
      noBtn.style.border = "0";
      noBtn.onclick = goStage3;
      return;
    }
    noBtn.textContent = noPhrases[++noCount];
  });

  yesBtn.addEventListener("click", goStage3);

  // ===== LISTY =====
  const letters = [
    {
      id: "bday-2026-02-06",
      date: "06.02.2026",
      badge: "üéÇ Urodziny",
      title: "Wszystkiego najlepszego! üéÇüíñ",
      body: [
        "W dniu Twoich urodzin chcƒô Ci powiedzieƒá, ≈ºe jeste≈õ najpiƒôkniejszƒÖ czƒô≈õciƒÖ mojego ≈õwiata.",
        "≈ªyczƒô Ci spe≈Çnienia marze≈Ñ, spokoju w sercu i codziennych powod√≥w do u≈õmiechu ‚Äî takich, kt√≥re zostajƒÖ na d≈Çugo.",
        "Niech ka≈ºdy dzie≈Ñ przynosi Ci dobro, ciep≈Ço i ludzi, przy kt√≥rych czujesz siƒô kochana i bezpieczna.",
        "A ja‚Ä¶ obiecujƒô byƒá obok ‚Äî wspieraƒá Ciƒô, trzymaƒá za rƒôkƒô i kochaƒá Ciƒô coraz mocniej. üíû"
      ],
      sign: "‚Äì Mateusz"
    },
    {
      id: "val-2026-02-14",
      date: "14.02.2026",
      badge: "üíå Walentynki",
      title: "Dla Ciebie üíñ",
      body: [
        "Chcƒô, ≈ºeby≈õ wiedzia≈Ça, ≈ºe jeste≈õ moim spokojem i mojƒÖ rado≈õciƒÖ.",
        "Ka≈ºdy dzie≈Ñ z TobƒÖ jest jak ma≈Çe ≈õwiƒôto ‚Äî nawet gdy jest zwyczajny.",
        "Dziƒôkujƒô, ≈ºe jeste≈õ. üíû",
        "Kocham Ciƒô mocniej ni≈º wczoraj i s≈Çabiej ni≈º jutro. üíñ"
      ],
      sign: "‚Äì Mateusz"
    }
  ];

  function parsePLDate(d){
    const [dd,mm,yyyy] = d.split(".").map(Number);
    return new Date(yyyy, mm-1, dd);
  }
  // sort rosnƒÖco po dacie
  letters.sort((a,b)=> parsePLDate(a.date) - parsePLDate(b.date));

  let currentLetterId = letters[letters.length - 1]?.id || null;

  function renderLetterById(id){
    const L = letters.find(x=>x.id === id) || letters[0];
    currentLetterId = L.id;

    letterDate.textContent = L.date;
    letterTitle.textContent = L.title;
    letterSign.textContent = L.sign;

    letterBody.innerHTML = "";
    L.body.forEach(t=>{
      const p = document.createElement("p");
      p.textContent = t;
      letterBody.appendChild(p);
    });

    document.querySelectorAll(".letterCard[data-id]").forEach(el=>{
      el.style.outline = (el.dataset.id === L.id) ? "2px solid rgba(255,255,255,.55)" : "none";
    });
  }

  // ===== ZDJƒòCIA =====
  const photoFiles = Array.from({length:10}, (_,i)=> `photos/${String(i+1).padStart(2,"0")}.jpeg`);

  let folderOpen = false;

  function toggleFolder(force){
    folderOpen = (typeof force === "boolean") ? force : !folderOpen;
    folder.classList.toggle("open", folderOpen);
    folder.setAttribute("aria-hidden", String(!folderOpen));

    const book = document.getElementById("bookCard");
    if(book) book.classList.toggle("open", folderOpen);
  }

  function buildPhotos(){
    photoGrid.innerHTML = "";
    photoFiles.forEach((src, idx)=>{
      const div = document.createElement("div");
      div.className = "thumb";
      div.setAttribute("role","button");
      div.setAttribute("tabindex","0");
      div.setAttribute("aria-label", `Otw√≥rz zdjƒôcie ${idx+1}`);

      const img = document.createElement("img");
      img.alt = `Zdjƒôcie ${idx+1}`;
      img.src = src;

      img.addEventListener("load", ()=> div.classList.add("loaded"));
      img.addEventListener("error", ()=> div.classList.remove("loaded"));

      const label = document.createElement("div");
      label.className = "thumbLabel";
      label.textContent = src.replace("photos/","");

      const open = ()=> openLightboxFromThumb(idx, div);

      div.addEventListener("click", open);
      div.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          open();
        }
      });

      div.appendChild(img);
      div.appendChild(label);
      photoGrid.appendChild(div);
    });
  }

  // ===== Lightbox: nawigacja + slideshow + zoom-from-thumb =====
  let currentPhotoIndex = 0;
  let slideshowTimer = null;
  let slideshowOn = false;
  let lastThumbRect = null;

  function setCounter(){
    lbCounter.textContent = `${currentPhotoIndex+1} / ${photoFiles.length}`;
  }

  function showPhoto(index, animate=false){
    const safeIndex = (index + photoFiles.length) % photoFiles.length;
    currentPhotoIndex = safeIndex;
    lightboxImg.src = photoFiles[currentPhotoIndex];
    lightboxImg.alt = `Zdjƒôcie ${currentPhotoIndex+1}`;
    setCounter();

    if(animate){
      lightboxImg.animate([{opacity:.5, transform:"scale(.985)"},{opacity:1, transform:"scale(1)"}], {duration:180, easing:"ease-out"});
    }
  }

  function openLightboxFromThumb(idx, thumbEl){
    currentPhotoIndex = idx;
    lastThumbRect = thumbEl?.getBoundingClientRect?.() || null;

    lightbox.classList.add("show");
    lightbox.setAttribute("aria-hidden","false");

    const imgEl = lightboxImg;
    const stage = document.getElementById("lightboxStage");
    const stageRect = stage.getBoundingClientRect();

    showPhoto(currentPhotoIndex, false);

    if(lastThumbRect){
      const startX = lastThumbRect.left + lastThumbRect.width/2;
      const startY = lastThumbRect.top + lastThumbRect.height/2;

      const endX = stageRect.left + stageRect.width/2;
      const endY = stageRect.top + stageRect.height/2;

      const dx = startX - endX;
      const dy = startY - endY;

      const scale = Math.max(0.12, Math.min(0.35, lastThumbRect.width / stageRect.width));

      imgEl.style.transform = `translate(${dx}px, ${dy}px) scale(${scale})`;
      imgEl.style.opacity = "0.0";

      requestAnimationFrame(()=>{
        imgEl.style.transition = "transform .38s ease, opacity .28s ease";
        imgEl.style.transform = "translate(0px,0px) scale(1)";
        imgEl.style.opacity = "1";
        setTimeout(()=>{ imgEl.style.transition = ""; }, 420);
      });
    } else {
      imgEl.style.transform = "translate(0,0) scale(1)";
      imgEl.style.opacity = "1";
    }

    startSlideshow(true);
  }

  function closeLightbox(){
    stopSlideshow(true);
    lightbox.classList.remove("show");
    lightbox.setAttribute("aria-hidden","true");
  }

  function nextPhoto(){ showPhoto(currentPhotoIndex + 1, true); }
  function prevPhoto(){ showPhoto(currentPhotoIndex - 1, true); }

  lbNext.addEventListener("click", (e)=>{ e.stopPropagation(); nextPhoto(); });
  lbPrev.addEventListener("click", (e)=>{ e.stopPropagation(); prevPhoto(); });

  lbClose.addEventListener("click", (e)=>{ e.stopPropagation(); closeLightbox(); });

  lightbox.addEventListener("click", closeLightbox);

  addEventListener("keydown", (e)=>{
    if(!lightbox.classList.contains("show")) return;
    if(e.key === "Escape") closeLightbox();
    if(e.key === "ArrowRight") nextPhoto();
    if(e.key === "ArrowLeft") prevPhoto();
    if(e.key === " "){
      e.preventDefault();
      slideshowOn ? stopSlideshow() : startSlideshow();
    }
  });

  function startSlideshow(silent=false){
    slideshowOn = true;
    lbPlay.classList.add("active");
    lbPlay.textContent = "‚ùö‚ùö";
    if(slideshowTimer) clearInterval(slideshowTimer);
    slideshowTimer = setInterval(()=> nextPhoto(), 3200);
  }

  function stopSlideshow(silent=false){
    slideshowOn = false;
    lbPlay.classList.remove("active");
    lbPlay.textContent = "‚ñ∂Ô∏é";
    if(slideshowTimer) clearInterval(slideshowTimer);
    slideshowTimer = null;
  }

  lbPlay.addEventListener("click", (e)=>{
    e.stopPropagation();
    slideshowOn ? stopSlideshow() : startSlideshow();
  });

  // ===== Panel list√≥w: pierwsza karta to "KsiƒÖ≈ºka" (zdjƒôcia) =====
  function buildLettersGrid(){
    lettersGrid.innerHTML = "";

    // 1) ksiƒÖ≈ºka zawsze na poczƒÖtku (lewo->prawo)
    const book = document.createElement("div");
    book.className = "letterCard bookCard";
    book.id = "bookCard";

    const top = document.createElement("div");
    top.className = "cardTop";

    const date = document.createElement("div");
    date.className = "cardDate";
    date.textContent = "‚Äî";

    const badge = document.createElement("div");
    badge.className = "cardBadge";
    badge.textContent = "üìñ Album";

    top.appendChild(date);
    top.appendChild(badge);

    const title = document.createElement("div");
    title.className = "cardTitle";
    title.textContent = "Nasze zdjƒôcia";

    const hint = document.createElement("div");
    hint.className = "cardHint";
    hint.textContent = "Kliknij, aby otworzyƒá / zamknƒÖƒá";

    const ico = document.createElement("div");
    ico.className = "bookIcon";
    ico.textContent = "üìñ";

    book.appendChild(top);
    book.appendChild(title);
    book.appendChild(hint);
    book.appendChild(ico);

    book.addEventListener("click", ()=> toggleFolder());

    lettersGrid.appendChild(book);

    // 2) listy po dacie (lewo->prawo, g√≥ra->d√≥≈Ç)
    letters.forEach((L)=>{
      const card = document.createElement("div");
      card.className = "letterCard";
      card.dataset.id = L.id;

      const top = document.createElement("div");
      top.className = "cardTop";

      const date = document.createElement("div");
      date.className = "cardDate";
      date.textContent = L.date;

      const badge = document.createElement("div");
      badge.className = "cardBadge";
      badge.textContent = L.badge || "üìú List";

      top.appendChild(date);
      top.appendChild(badge);

      const title = document.createElement("div");
      title.className = "cardTitle";
      title.textContent = L.title;

      const hint = document.createElement("div");
      hint.className = "cardHint";
      hint.textContent = "Kliknij, aby w≈Ço≈ºyƒá do koperty";

      card.appendChild(top);
      card.appendChild(title);
      card.appendChild(hint);

      card.addEventListener("click", ()=>{
        renderLetterById(L.id);
      });

      lettersGrid.appendChild(card);
    });

    // stan ksiƒÖ≈ºki
    toggleFolder(false);
  }

  // ===== Etap 3 =====
  function goStage3(){
    stage2.classList.add("hidden");

    bgVideo.style.opacity = 1;
    bgVideo.play().catch(()=>{});

    music.currentTime = 0;
    music.volume = 0;
    music.play().catch(()=>{});
    fadeTo(music, MUSIC_VOL, 900);

    buildLettersGrid();
    renderLetterById(currentLetterId);
    buildPhotos();

    lettersPanel.classList.remove("hidden");
    lettersPanel.setAttribute("aria-hidden","false");

    noteTop.classList.remove("hidden");

    // koperta po 5s
    envelopeArea.classList.remove("showSoft");
    envelopeArea.classList.add("hiddenSoft");
    envelopeArea.setAttribute("aria-hidden","true");

    envelopeWrap.classList.remove("open");
    letter.setAttribute("aria-hidden","true");

    setTimeout(()=>{
      envelopeArea.classList.remove("hiddenSoft");
      envelopeArea.classList.add("showSoft");
      envelopeArea.setAttribute("aria-hidden","false");
    }, 5000);
  }

  // klik koperty: otw√≥rz / zamknij
  envelope.addEventListener("click", () => {
    const willOpen = !envelopeWrap.classList.contains("open");
    envelopeWrap.classList.toggle("open", willOpen);
    letter.setAttribute("aria-hidden", String(!willOpen));
  });

});
</script>
</body>
</html>
