<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>üíñ Dla Ciebie</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Cormorant+Garamond:wght@400;600&family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
:root{
  --bg1:#120014;
  --bg2:#2a0030;
  --text:#ffe9ff;
  --muted:#ffd0ffcc;
  --accent:#ff4da6;
  --accent2:#ff7aa8;

  --glass: rgba(0,0,0,.38);
  --glass2: rgba(0,0,0,.55);
  --glassBorder: rgba(255,255,255,.18);

  --paper:#fff7fb;
  --paperText:#240018;

  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  overflow:hidden;
  font-family:Poppins,system-ui,sans-serif;
  background:linear-gradient(160deg,var(--bg1),var(--bg2));
  color:var(--text);
}

/* ===== T≈ÅO MP4 ===== */
#bgVideo{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:0;
  opacity:0;
  transition:opacity 1.4s ease;
  filter:saturate(1.05) contrast(1.03);
}

/* ===== ETAPY ===== */
.stage{
  position:fixed;
  inset:0;
  display:grid;
  place-items:center;
  z-index:10;
  pointer-events:auto;
}
.hidden{display:none !important}

/* ETAP 1 */
.stage1{
  background:
    radial-gradient(900px 600px at 50% 40%, #ff4da61f, transparent 70%),
    linear-gradient(160deg, #0b000e, #230027);
}
.bigStartBtn{
  width:clamp(210px,60vw,360px);
  height:clamp(210px,60vw,360px);
  border-radius:50%;
  border:none;
  font-size:clamp(22px,5vw,34px);
  font-weight:900;
  cursor:pointer;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#120016;
  animation:pulse 1.2s infinite;
  box-shadow:0 18px 65px #ff2f8a55;
  -webkit-tap-highlight-color: transparent;
}
.bigStartBtn:active{ transform:scale(.98); }
@keyframes pulse{
  0%{box-shadow:0 18px 65px #ff2f8a55, 0 0 0 0 #ff4da6aa}
  70%{box-shadow:0 18px 65px #ff2f8a55, 0 0 0 35px transparent}
  100%{box-shadow:0 18px 65px #ff2f8a55, 0 0 0 0 transparent}
}

/* ETAP 2 */
.stage2{ background:transparent; }
.askBox{
  width:clamp(320px,86vw,680px);
  padding:clamp(22px,6vw,60px);
  border-radius:28px;
  background:#ffffff14;
  border:1px solid #ffffff22;
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  text-align:center;
  box-shadow:0 22px 70px #00000066;
}
.askTitle{
  font-family:"Great Vibes",cursive;
  font-size:clamp(36px,8vw,74px);
  line-height:1;
}
.askSubtitle{
  margin-top:12px;
  font-size:clamp(14px,3.2vw,18px);
  color:#ffd0ffdd;
}
.btnRow{
  margin-top:clamp(18px,4vw,34px);
  display:flex;
  justify-content:center;
  gap:clamp(12px,3vw,30px);
  flex-wrap:wrap;
}
.btn{
  padding:clamp(14px,3vw,18px) clamp(22px,5vw,38px);
  border-radius:999px;
  border:none;
  font-size:clamp(16px,3.5vw,26px);
  font-weight:900;
  cursor:pointer;
  box-shadow:0 16px 40px #00000035;
  -webkit-tap-highlight-color: transparent;
}
.btn:active{ transform:scale(.98); }
.yesBtn{ background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#120016; }
.noBtn{ background:#ffffff20; color:var(--text); border:1px solid #ffffff30; }

/* ===== ETAP 3 UI (IKONY) ===== */
.ui{
  position:fixed;
  inset:0;
  z-index:20;
  pointer-events:none;
}

.iconDock{
  position:fixed;
  inset:0;
  display:grid;
  place-items:center;
  z-index:30;
  pointer-events:auto;
}

.iconsGrid{
  width:min(980px, 94vw);
  display:grid;
  grid-template-columns:repeat(4, minmax(0,1fr));
  gap:clamp(14px, 3vw, 26px);
  padding:clamp(14px, 3vw, 18px);
}
@media (max-width:900px){ .iconsGrid{ grid-template-columns:repeat(3, minmax(0,1fr)); } }
@media (max-width:520px){ .iconsGrid{ grid-template-columns:repeat(2, minmax(0,1fr)); } }

.appIcon{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  opacity:0;
  transform:translateY(10px) scale(.985);
  animation: appIn .65s ease forwards;
}
@keyframes appIn{
  to { opacity:1; transform:translateY(0) scale(1); }
}
.iconBtn{
  width:clamp(78px, 16vw, 108px);
  height:clamp(78px, 16vw, 108px);
  border-radius:24px;
  border:1px solid rgba(255,255,255,.22);
  background:linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.08));
  box-shadow:0 18px 60px rgba(0,0,0,.45);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  display:grid;
  place-items:center;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}
.iconBtn:active{ transform:scale(.98); }
.iconEmoji{ font-size:40px; line-height:1; }
.iconLabel{
  font-weight:900;
  color:#ffe9ffef;
  font-size:clamp(12px, 2.8vw, 14px);
  text-align:center;
  text-shadow:0 10px 30px rgba(0,0,0,.55);
}

/* ===== MODALE ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.78);
  z-index:200;
  display:none;
  pointer-events:auto;
}
.modal.show{ display:grid; place-items:center; }

.modalCard{
  width:min(980px, 94vw);
  max-height:92vh;
  overflow:auto;
  background:var(--glass2);
  border:1px solid rgba(255,255,255,.18);
  border-radius:24px;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow:0 30px 100px rgba(0,0,0,.70);
  padding:clamp(14px, 3vw, 20px);
  position:relative;
}

/* Zamknij */
.closeBtn{
  position:sticky;
  top:10px;
  float:right;
  z-index:5;
  border:none;
  cursor:pointer;
  width:44px;
  height:44px;
  border-radius:14px;
  background:rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.18);
  color:#fff;
  font-size:18px;
  font-weight:900;
}
.closeBtn:active{ transform:scale(.98); }

/* ===== List modal ===== */
.letterShell{
  width:100%;
  display:grid;
  place-items:center;
  padding:8px 0 18px;
}

.envelopeHero{
  width:min(560px, 92vw);
  height:clamp(170px, 34vw, 280px);
  position:relative;
  margin:6px auto 14px;
  filter: drop-shadow(0 22px 70px rgba(0,0,0,.55));
}

.env{
  position:absolute;
  inset:0;
  border-radius:18px;
  background:linear-gradient(145deg, rgba(255,255,255,.92), rgba(255,255,255,.84));
  border:1px solid rgba(255,255,255,.40);
  overflow:hidden;
}

.envBottom:before,
.envBottom:after{
  content:"";
  position:absolute;
  bottom:0;
  width:60%;
  height:64%;
  background:linear-gradient(135deg, var(--accent), var(--accent2));
  opacity:.95;
}
.envBottom:before{ left:-10%; clip-path:polygon(0 100%, 100% 100%, 100% 0); }
.envBottom:after{ right:-10%; clip-path:polygon(0 0, 0 100%, 100% 100%); }

.envMid{
  position:absolute;
  inset:0;
  background:linear-gradient(135deg, rgba(255,77,166,.92), rgba(255,122,168,.92));
  clip-path:polygon(0 100%, 50% 55%, 100% 100%, 50% 100%);
  opacity:.55;
}

.envFlap{
  position:absolute;
  top:-1px;
  left:-1px;
  right:-1px;
  height:65%;
  background:linear-gradient(135deg, var(--accent), var(--accent2));
  clip-path:polygon(0 0, 100% 0, 50% 62%);
  transform-origin:top center;
  transform:rotateX(0deg);
  transition: transform .65s cubic-bezier(.2,.9,.2,1);
  box-shadow:0 12px 30px rgba(0,0,0,.18);
}
.env.open .envFlap{ transform:rotateX(165deg); }

.seal{
  position:absolute;
  left:50%;
  top:58%;
  transform:translate(-50%,-50%);
  width:58px;
  height:58px;
  border-radius:50%;
  background:rgba(255,255,255,.25);
  border:1px solid rgba(255,255,255,.35);
  backdrop-filter: blur(8px);
  display:grid;
  place-items:center;
}
.seal span{ font-size:24px; }

/* Papier: pe≈Çna szeroko≈õƒá, nie zas≈Çaniane */
.paper{
  width:min(880px, 94vw);
  background:linear-gradient(180deg, #fff, var(--paper));
  color:var(--paperText);
  border-radius:22px;
  border:1px solid rgba(0,0,0,.08);
  box-shadow:0 14px 45px rgba(0,0,0,.20);
  padding:clamp(16px, 3.6vw, 28px);
}

.paperTop{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}
.paperDate{
  font-size:12px;
  color:rgba(0,0,0,.55);
  font-weight:900;
}
.paperTitle{
  font-family:"Great Vibes",cursive;
  font-size:clamp(34px, 7vw, 62px);
  margin:8px 0 6px;
  line-height:1.05;
}
.paperBody{
  font-family:"Cormorant Garamond",serif;
  font-size:clamp(18px, 3.8vw, 26px);
  line-height:1.55;
}
.paperBody p{ margin:10px 0; }
.paperSign{
  margin-top:14px;
  font-family:"Great Vibes",cursive;
  font-size:clamp(22px, 5vw, 40px);
  text-align:right;
}

/* ===== Album modal (scroll g√≥ra/d√≥≈Ç) ===== */
.albumWrap{
  width:min(980px, 94vw);
  margin:0 auto;
}
.albumTitle{
  font-weight:900;
  font-size:clamp(16px, 3.2vw, 18px);
  margin:0 0 12px;
  color:#ffd0ffef;
}
.albumScroller{
  max-height:72vh;
  overflow-y:auto;
  overscroll-behavior:contain;
  padding-right:6px;
}
.albumGrid{
  display:grid;
  grid-template-columns:repeat(3, minmax(0,1fr));
  gap:12px;
}
@media (max-width:700px){ .albumGrid{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
@media (max-width:420px){ .albumGrid{ grid-template-columns:repeat(1, minmax(0,1fr)); } }

.thumb{
  border-radius:18px;
  overflow:hidden;
  position:relative;
  background:rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.22);
  box-shadow:0 14px 40px rgba(0,0,0,.35);
  aspect-ratio: 1 / 1;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}
.thumb::after{
  content:"";
  position:absolute;
  inset:0;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.10);
  pointer-events:none;
}
.thumb img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  opacity:0;
  transform:scale(1);
  transition:opacity .35s ease, transform .25s ease;
}
.thumb.loaded img{ opacity:1; }
.thumb:hover img{ transform:scale(1.03); }

/* ===== Lightbox: tylko fullscreen + zamknij ===== */
#lightbox{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.86);
  display:none;
  place-items:center;
  z-index:999;
  cursor:pointer;
  padding:18px;
}
#lightbox.show{ display:grid; }
#lightbox img{
  max-width:min(1200px, 96vw);
  max-height:92vh;
  border-radius:22px;
  box-shadow:0 30px 90px rgba(0,0,0,.75);
}
  </style>
</head>

<body>
  <video id="bgVideo" muted loop playsinline preload="auto">
    <source src="background.mp4" type="video/mp4">
  </video>

  <!-- ETAP 1 -->
  <div id="stage1" class="stage stage1">
    <button id="startBigBtn" class="bigStartBtn">Kliknij</button>
  </div>

  <!-- ETAP 2 -->
  <div id="stage2" class="stage stage2 hidden">
    <div class="askBox">
      <div class="askTitle">Mam pytanie‚Ä¶ üíû</div>
      <div class="askSubtitle">Czy zostaniesz mojƒÖ walentynkƒÖ ?</div>
      <div class="btnRow">
        <button id="yesBtn" class="btn yesBtn">Tak</button>
        <button id="noBtn" class="btn noBtn">Nie</button>
      </div>
    </div>
  </div>

  <!-- ETAP 3 -->
  <div class="ui">
    <div class="iconDock hidden" id="iconDock" aria-hidden="true">
      <div class="iconsGrid" id="iconsGrid"></div>
    </div>
  </div>

  <!-- MODAL: LIST -->
  <div class="modal" id="letterModal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true">
      <button class="closeBtn" id="closeLetter" type="button">‚úï</button>

      <div class="letterShell">
        <div class="envelopeHero">
          <div class="env" id="envAnim">
            <div class="envBottom"></div>
            <div class="envMid"></div>
            <div class="envFlap"></div>
            <div class="seal"><span>üíó</span></div>
          </div>
        </div>

        <div class="paper" id="paper">
          <div class="paperTop">
            <div class="paperDate" id="paperDate">‚Äî</div>
          </div>
          <div class="paperTitle" id="paperTitle">‚Äî</div>
          <div class="paperBody" id="paperBody"></div>
          <div class="paperSign" id="paperSign">‚Äî</div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: ALBUM -->
  <div class="modal" id="albumModal" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true">
      <button class="closeBtn" id="closeAlbum" type="button">‚úï</button>
      <div class="albumWrap">
        <div class="albumTitle">Album</div>
        <div class="albumScroller" id="albumScroller">
          <div class="albumGrid" id="albumGrid"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- LIGHTBOX -->
  <div id="lightbox" aria-hidden="true" title="Kliknij, aby zamknƒÖƒá">
    <img id="lightboxImg" alt="Powiƒôkszone zdjƒôcie">
  </div>

  <audio id="music" preload="auto" loop>
    <source src="music.mp3" type="audio/mpeg">
  </audio>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const stage1 = document.getElementById("stage1");
  const stage2 = document.getElementById("stage2");
  const startBtn = document.getElementById("startBigBtn");
  const yesBtn = document.getElementById("yesBtn");
  const noBtn  = document.getElementById("noBtn");

  const bgVideo = document.getElementById("bgVideo");
  const music = document.getElementById("music");

  const iconDock = document.getElementById("iconDock");
  const iconsGrid = document.getElementById("iconsGrid");

  // Modals
  const letterModal = document.getElementById("letterModal");
  const albumModal = document.getElementById("albumModal");
  const closeLetter = document.getElementById("closeLetter");
  const closeAlbum = document.getElementById("closeAlbum");

  const envAnim = document.getElementById("envAnim");
  const paperDate = document.getElementById("paperDate");
  const paperTitle = document.getElementById("paperTitle");
  const paperBody  = document.getElementById("paperBody");
  const paperSign  = document.getElementById("paperSign");

  // Album grid
  const albumGrid = document.getElementById("albumGrid");

  // Lightbox
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightboxImg");

  // Kliknij / Dotknij
  function isTouch(){
    return matchMedia("(pointer:coarse)").matches && !matchMedia("(pointer:fine)").matches;
  }
  function updateStartText(){
    startBtn.textContent = isTouch() ? "Dotknij" : "Kliknij";
  }
  updateStartText();
  addEventListener("resize", updateStartText);

  // Muzyka (g≈Ço≈õno≈õƒá)
  const MUSIC_VOL = 0.25;
  const clamp01 = (v)=> Math.max(0, Math.min(1, v));
  function fadeTo(el, target, ms=900){
    const to = clamp01(target);
    const from = clamp01(el.volume ?? 0);
    const t0 = performance.now();
    const tick = (t)=>{
      const k = Math.min(1, (t - t0)/ms);
      el.volume = clamp01(from + (to - from)*k);
      if(k < 1) requestAnimationFrame(tick);
    };
    requestAnimationFrame(tick);
  }

  // Etap 1 -> 2
  startBtn.addEventListener("click", () => {
    stage1.classList.add("hidden");
    stage2.classList.remove("hidden");
  });

  // Etap 2: zmiana tekst√≥w na "Nie"
  let noCount = 0;
  const noPhrases = ["Nie","Na pewno nie üòè","Spr√≥buj jeszcze raz","Prawie üò≥","No dobrze‚Ä¶"];
  noBtn.addEventListener("click", () => {
    if(noCount >= noPhrases.length - 1){
      noBtn.textContent = "Tak <3";
      noBtn.style.background = "linear-gradient(135deg,#ff4da6,#ff7aa8)";
      noBtn.style.color = "#120016";
      noBtn.style.border = "0";
      noBtn.onclick = goStage3;
      return;
    }
    noBtn.textContent = noPhrases[++noCount];
  });

  yesBtn.addEventListener("click", goStage3);

  // ===== LISTY (osobne) =====
  const letters = [
    {
      id: "bday-2026-02-06",
      date: "06.02.2026",
      emoji: "üéÇ",
      title: "Wszystkiego najlepszego! üéÇüíñ",
      body: [
        "W dniu Twoich urodzin chcƒô Ci powiedzieƒá, ≈ºe jeste≈õ najpiƒôkniejszƒÖ czƒô≈õciƒÖ mojego ≈õwiata.",
        "≈ªyczƒô Ci spe≈Çnienia marze≈Ñ, spokoju w sercu i codziennych powod√≥w do u≈õmiechu ‚Äî takich, kt√≥re zostajƒÖ na d≈Çugo.",
        "Niech ka≈ºdy dzie≈Ñ przynosi Ci dobro, ciep≈Ço i ludzi, przy kt√≥rych czujesz siƒô kochana i bezpieczna.",
        "A ja‚Ä¶ obiecujƒô byƒá obok ‚Äî wspieraƒá Ciƒô, trzymaƒá za rƒôkƒô i kochaƒá Ciƒô coraz mocniej. üíû"
      ],
      sign: "‚Äì Mateusz"
    },
    {
      id: "val-2026-02-14",
      date: "14.02.2026",
      emoji: "üíå",
      title: "Dla Ciebie üíñ",
      body: [
        "Chcƒô, ≈ºeby≈õ wiedzia≈Ça, ≈ºe jeste≈õ moim spokojem i mojƒÖ rado≈õciƒÖ.",
        "Ka≈ºdy dzie≈Ñ z TobƒÖ jest jak ma≈Çe ≈õwiƒôto ‚Äî nawet gdy jest zwyczajny.",
        "Dziƒôkujƒô, ≈ºe jeste≈õ. üíû",
        "Kocham Ciƒô mocniej ni≈º wczoraj i s≈Çabiej ni≈º jutro. üíñ"
      ],
      sign: "‚Äì Mateusz"
    }
  ];

  function parsePLDate(d){
    const [dd,mm,yyyy] = d.split(".").map(Number);
    return new Date(yyyy, mm-1, dd);
  }
  // sort rosnƒÖco po dacie
  letters.sort((a,b)=> parsePLDate(a.date) - parsePLDate(b.date));

  // ===== ZDJƒòCIA (10 szt.) =====
  const photoFiles = Array.from({length:10}, (_,i)=> `photos/${String(i+1).padStart(2,"0")}.jpeg`);

  // ===== IKONY jak na telefonie =====
  function buildIcons(){
    iconsGrid.innerHTML = "";

    // Album zawsze pierwszy
    const albumIcon = makeAppIcon({
      id: "album",
      emoji: "üìñ",
      label: "Album",
      onClick: openAlbum
    }, 0);
    iconsGrid.appendChild(albumIcon);

    // Potem listy (kolejno≈õƒá po dacie), lewo->prawo, g√≥ra->d√≥≈Ç
    letters.forEach((L, i)=>{
      const node = makeAppIcon({
        id: L.id,
        emoji: L.emoji || "üíå",
        label: L.date, // pod ikonƒÖ data
        onClick: ()=> openLetter(L.id)
      }, i+1);
      iconsGrid.appendChild(node);
    });
  }

  function makeAppIcon({id, emoji, label, onClick}, index){
    const wrap = document.createElement("div");
    wrap.className = "appIcon";
    wrap.style.animationDelay = (index * 0.14) + "s";

    const btn = document.createElement("button");
    btn.className = "iconBtn";
    btn.type = "button";
    btn.setAttribute("aria-label", label);
    btn.dataset.id = id;

    const em = document.createElement("div");
    em.className = "iconEmoji";
    em.textContent = emoji;

    const lab = document.createElement("div");
    lab.className = "iconLabel";
    lab.textContent = label;

    btn.appendChild(em);
    wrap.appendChild(btn);
    wrap.appendChild(lab);

    btn.addEventListener("click", onClick);

    return wrap;
  }

  // ===== LIST MODAL =====
  function renderLetter(L){
    paperDate.textContent = L.date;
    paperTitle.textContent = L.title;
    paperSign.textContent = L.sign;

    paperBody.innerHTML = "";
    L.body.forEach(t=>{
      const p = document.createElement("p");
      p.textContent = t;
      paperBody.appendChild(p);
    });
  }

  function openLetter(id){
    const L = letters.find(x=>x.id === id) || letters[0];
    renderLetter(L);

    // reset anim
    envAnim.classList.remove("open");
    letterModal.classList.add("show");
    letterModal.setAttribute("aria-hidden","false");

    // animacja koperty (otwarcie) dopiero po klikniƒôciu
    requestAnimationFrame(()=>{
      setTimeout(()=> envAnim.classList.add("open"), 120);
    });
  }

  function closeLetterModal(){
    letterModal.classList.remove("show");
    letterModal.setAttribute("aria-hidden","true");
    envAnim.classList.remove("open");
  }

  closeLetter.addEventListener("click", (e)=>{ e.stopPropagation(); closeLetterModal(); });
  letterModal.addEventListener("click", (e)=>{
    if(e.target === letterModal) closeLetterModal();
  });

  // ===== ALBUM MODAL (scroll g√≥ra/d√≥≈Ç) =====
  function buildAlbum(){
    albumGrid.innerHTML = "";
    photoFiles.forEach((src, idx)=>{
      const div = document.createElement("div");
      div.className = "thumb";
      div.setAttribute("role","button");
      div.setAttribute("tabindex","0");
      div.setAttribute("aria-label", `Otw√≥rz zdjƒôcie ${idx+1}`);

      const img = document.createElement("img");
      img.alt = `Zdjƒôcie ${idx+1}`;
      img.src = src;
      img.addEventListener("load", ()=> div.classList.add("loaded"));
      img.addEventListener("error", ()=> div.classList.remove("loaded"));

      const open = ()=> openLightbox(src, img.alt);
      div.addEventListener("click", open);
      div.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          open();
        }
      });

      div.appendChild(img);
      albumGrid.appendChild(div);
    });
  }

  function openAlbum(){
    albumModal.classList.add("show");
    albumModal.setAttribute("aria-hidden","false");
  }

  function closeAlbumModal(){
    albumModal.classList.remove("show");
    albumModal.setAttribute("aria-hidden","true");
  }

  closeAlbum.addEventListener("click", (e)=>{ e.stopPropagation(); closeAlbumModal(); });
  albumModal.addEventListener("click", (e)=>{
    if(e.target === albumModal) closeAlbumModal();
  });

  // ===== LIGHTBOX =====
  function openLightbox(src, alt){
    lightboxImg.src = src;
    lightboxImg.alt = alt || "Zdjƒôcie";
    lightbox.classList.add("show");
    lightbox.setAttribute("aria-hidden","false");
  }
  function closeLightbox(){
    lightbox.classList.remove("show");
    lightbox.setAttribute("aria-hidden","true");
  }
  lightbox.addEventListener("click", closeLightbox);
  addEventListener("keydown", (e)=>{
    if(e.key === "Escape"){
      if(lightbox.classList.contains("show")) closeLightbox();
      if(letterModal.classList.contains("show")) closeLetterModal();
      if(albumModal.classList.contains("show")) closeAlbumModal();
    }
  });

  // ===== Etap 3 =====
  function goStage3(){
    stage2.classList.add("hidden");

    // start video i muzyka w ge≈õcie usera
    bgVideo.style.opacity = 1;
    bgVideo.play().catch(()=>{});

    music.currentTime = 0;
    music.volume = 0;
    music.play().catch(()=>{});
    fadeTo(music, MUSIC_VOL, 900);

    // nic siƒô nie otwiera automatycznie
    buildIcons();
    buildAlbum();

    iconDock.classList.remove("hidden");
    iconDock.setAttribute("aria-hidden","false");
  }

});
</script>
</body>
</html>
